---
title: "Are there discrepancies in the counts of principal and alternative qualifiers?"
author: Joseph S. Tabadero, Jr.\thanks{Special Science Teacher IV, Philippine Science
  High School-CAR Campus}
date: "9/24/2018"
output:
  pdf_document:
    keep_tex: yes
  html_document:
    df_print: paged
classoptions: a4paper, 11pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning =F, cache = T)
```



```{r}
source("nce_data_structuring.R")
```

The title says it all. As I was investigating the number of principal and alternate qualifiers by region, and by preferred campus and year, I noticed that there are small discrepancies in the *pass flag* tag as (supposedly) generated by FAPS and the counts that I get when I implemented the following rules in determining principal and alternative qualifiers:

1. An NCE applicant is a *principal qualifier* if his/her total score is above the mean total score and his/her sub-test scores are higher than the sub-test mean scores.
2. An NCE applicant is an *alternate qualifier* if:
  (a) he/she preferred Main Campus but although his/her total score is above the mean total score, and his/her Math and Science sub-test scores are above the corresponding sub-test mean scores, his/her other sub-test scores may be below the mean of the sub-test scores, although none of the other sub-test score is below 90% of the corresponding sub-test mean score;
  (b) he/she preferred a regional campus, and his/her total score is above the mean total score and at least one of his/her sub-test is below the mean of the corresponding sub-test score but not less than 90% of the corresponding mean of the sub-test score.
  
  Please direct your attention to Table 1. Supposedly, the column under *1, F* should be zero throughout the years. This is true for the most recent years 2016, and 2017. But as recent as 2015, there were 3 applicants who were considered principal qualifiers (pass flag of 1) when they were not supposed to be (tagged *F*). 

```{r}
dcast(setDT(ncetd %>% distinct(year, id, pass_flag, passflag2, year, region_name)), year ~ pass_flag + passflag2, value.var = "passflag2", fun.aggregate = length) %>%
  adorn_totals(where = "row") %>%
  kable("latex", booktabs = T, col.names = c("Year", rep(c("P", "A", "F"), times = 2)), caption = "Distribution of NCE Takers by Year") %>%
  add_header_above(c("Pass Flag"=1, "1"=3,"2"=3)) %>%
  add_footnote(c("Pass Flag: 1--Passed; 2--Failed", "P--Principal Qualifier, A--Alternative Qualifier, F--Failed"))
```

Further investigation revealed the cases for the year 2015, as shown in Table 2.

```{r}
ncetd %>% filter(year == 2015, passflag2 == "F", pass_flag == 1) %>% select(year, id, total, total_mean, subject, score, mean, total) %>% kable("latex", booktabs = T, caption = "Principal qualifiers in 2015 who were not supposed to pass according to admission rules.")
```

Zooming in to a particular case, we have a case from 2015 who applied for MIMAROPA Regional Campus as his/her preferred campus, but his/her sub-test score in math is below the 90% of the sub-test mean score for math in 2015. However, this applicant has a 1 pass flag tag. Here, we note that there were many examinees whose scores should have qualified them as principal qualifiers.

```{r}
ncetd %>% filter(year == 2015, id == 2088) %>% select(year, id, total, total_mean, subject, score, mean) %>% kable("latex", booktabs = T, caption = "A breakdown of scores of one principal qualifier from MIMAROPA Region Campus.")
```

I am not familiar with the factors leading up to these minor discrepancies, but this should serve as an initial review of FAPS.

```{r}
curious_cases <- ncetd %>% filter(passflag2 == "F", pass_flag == 1)
fwrite(curious_cases, "curious_cases.csv")
```



```{r}
ncetd %>% filter(year == 2015, passflag2 == "F", pass_flag == 1)
```

```{r}
ncetd %>% filter(year == 2015, id == 75185)
```

