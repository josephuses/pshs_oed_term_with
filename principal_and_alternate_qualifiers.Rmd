---
title: "How Many Scholarship Slots are too Many in the PSHS Campuses?"
author: Joseph S. Tabadero, Jr.\thanks{Special Science Teacher IV, Philippine Science
  High School-CAR Campus}
date: "9/6/2018"
output:
  pdf_document:
    keep_tex: yes
  html_document:
    df_print: paged
subtitle: Counting Top Passers, and Comparing the Relative Performances Against Principal
  and Alternate Qualifiers
classoptions: a4paper, 11pt
toc: yes
header-includes:
  - \input{preamble.tex}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning =F, cache = T)
```


```{r}
source("nce_data_structuring.R")
```

## Executive Summary

* At least three indicators can be set to determine the capability of a campus to offer more scholarship slots: (1) infrastructure; (2) the depth of the pool of qualified applicants by campus of choice; and (3) the capability of instructional services, by campus, to bring every accepted scholar up to PSHS standards. In this paper, we are going to focus on indicators 2 and 3. 
* To investigate indicator 2, we shall look at the top 1590 passers nationwide to determine the number of scholars in each campus who belonged to the top 1590 and the number of principal qualifiers in each campus who are not in the top 1590, nationwide. The number 1590 is chosen because that is the sum of slots available if we assume 240 slots for the Main Campus and 90 slots for each of the 15 regional campuses. 
* An *NCE passer* is defined as any NCE applicant whose score in each subject is above the subject mean score for the applicable NCE year. A *principal qualifier* is an NCE passer who either belongs to the top 240 NCE passers nationwide or to the top 90 NCE passers for his or her campus of first choice. We note that a principal qualifier may not belong to the top 1590 NCE passers, nationwide. 
* Additionally, we shall look at the top 3180 passers nationwide. Ideally, the alternate qualifiers should belong to the top 3180 passers nationwide.
* Based on the count of top 1590 passers who signified interest for each campus, **Main Campus, CLC, and CBZRC** have passers that almost double the available scholarship slots, throughout the years. Meanwhile, SMC and WVC can offer 30-60 more scholarship slots.
* Regarding alternate qualifiers, based on the top 3180 passers nationwide (to diminish burden on instruction):
  - BRC can choose from among 50-150 alternates.
  - CARC can choose from among 20-60 alternates.
  - CBZRC can choose from among 100-300 alternates.
  - CLC can choose from among 100-400 alternates.
  - CVC can choose from among 30-90 alternates.
  - CVISC can choose from among 30-60 alternates.
  - EVC can choose from among 39-100 alternates.
  - IRC can choose from among 30-60 alternates.
  - Main Campus can choose from about 500 alternates.
  - SMC can choose from about 150 alternates.
  - WVC can choose from 150-200 alternates.
* On the other hand, CRC, MRC, SRC, and ZRC may opt not to enrol some more alternates in order to lessen the burden of instruction. These campuses should campaign for more applicants.
* In terms of the relative performances in the Readiness Examination of the principal and alternative qualifiers, there is no appreciable difference, with the principal qualifiers only having a slight edge in math, physics and statistics. This may mean two things:
  - The alternative qualifiers can catch up with the principal qualifiers in a level learning field.
  - The instructional services in each campus is capable in bringing every scholar up to par.

## Philippine Science High School Everywhere

With the establishment of the MIMAROPA campus, the Philippine Science High School is now one region away from establishing a campus in every region in the country---as mandated by Republic Act 8496 (otherwise known as "Philippine Science High School (PSHS) System Act of 1997") as amended by Republich Act 9036. This mandate empowers the PSHS System's Board of Trustees to "develop policies for the expansion of enrollment in campuses under the PSHS System" (Section 7 (j)). However, up until CALABARZON Campus increased the number of scholarship slots, there has yet to be a system by which the BOT can determine the readiness of a campus to expand expand enrollment.

We look at three factors affecting the capability of a campus to expand enrollment: (1) available infrastructure and budget; (2) the depth of the pool of qualified applicants by campus of choice; and (3) the capability of instructional services to bring every accepted scholar up to PSHS standards. The first factor is easily ascertained by inspection. In this paper, we investigate and propse indicators for factor 2. Factor 3 is a more broad topic that can be covered by future papers, hopefully in collaboration with researchers from different campuses.

## Counting Qualified Applicants

While the PSHS System is mandated to provide equal opportunity for each region to have an access to a PSHS campus, RA 8496 also requires standards for it to follow by "offering scholarships to deserving students" (Title I, Sec. 4). This is done through a rigorous selection process starting with the National Competitive Examination (NCE). 

The NCE is composed of 4 tests---verbal, mathematics, science, and abstract reasoning. An *NCE passer* is defined as any NCE applicant whose score in each subject is above the subject mean score for the applicable NCE year. A *principal qualifier* is an NCE passer who either belongs to the top 240 NCE passers nationwide or to the top 90 NCE passers for his or her first preffered regional campus, with the exception of CALABARZON Region Campus where BOT has already increased the enrollment to 120. An *alternate qualifier* is determined using a more elaborate set of rules. However, for the purpose of this paper, we shall take the first two rules for our definition of an *alternate qualifier*:

> To be an alternate in the Main Campus, an examinee should satisfy the following eligibility:

> i. Total score is above the national mean; and

> ii. Sub-test Scores in Quantitative and Scientific Abilities must all be greater than or equal to the corresponding national means. On the other hand Sub-test Scores in Verbal Aptitude and Abstract Reasoning must be greater than or equal to 90% of the national mean. For example, if the national mean score in verbal aptitude is 25, an examinee is eligible as alternate if his/her score is at least 22.50.

> To be an alternate in the Regional Campus, an examinee should satisfy the following eligibility:

> i.	Total score is above the national mean; and 

> ii.	Sub-test Score per subject must be greater than or equal to 90% of the national mean. For example, if the national mean score in verbal aptitude is 25, an examinee is eligible as alternate if his/her score is at least 22.50. 


A natural choice of indicator for the second factor are the numbers of principal and alternative qualifiers. However, this is a relative measure since the principal and alternative qualifiers are determined by factors such as campus of preference (first and second), which ensures an equitable distribution of scholarship opportunities for each region. A less obvious---but more standard---indicator is *the number of passers each campus (as first choice) has in the top 1620 passing examinees nationwide*. Here, we note that a principal qualifier in a campus might not be in the top 1620 passers. We arrive at the number 1620 by assuming 240 scholarship slots for Main Campus, 120 scholarship slots for CALABARZON Region Campus, and 90 scholarship slots for each of the other 14 existing regional campuses. Our assumption is that if the quality of applicants are the same throughout the regions of the country, then the number of NCE passers in the top 1620 from each region should be the same as the corresponding scholarship slots, which should be primarily dictated by the population of that region. This indicator can then show us: (i) how many NCE passers who belonged to the top 1620 did not qualify as a principal qualifier; and, alternatively, (ii) how many principal qualifiers did not belong to the top 1620 NCE passers. Counting the number of the top 1620 NCE passers in each campus gives us an idea of whether or not we are giving scholarship slots to the most deserving applicants, while maintaining equal opportunity for applicants from the different regions to avail of a scholarship.

The top 3180 NCE passers, on the other hand, can give us an idea on how deep in the list of alternate qualifiers the PSHS can go and still ensure that the quality of scholars is not compromised. Again, we can count the number of passers for each campus of choice who belong to the top 3180 NCE passers.

## Why do we have identify the number of top 1620 passers?

Our attempt to count the number of passers who belong to the top 1620 NCE Examinees will make more sense if we count the number of passers and possible alternates per year. In Table 1, we can see that we have many passers than available scholarships throughout the years. However, the campuses differ in terms of preference by the NCE applicants. For instance, Main Campus has been perennially chosen by many applicants as their campus of first choice. In the other extreme, we see very few passers choosing MIMAROPA Regional Campus since 2015. Since only a limited number of scholarship slots are available, a system of choosing the principal qualifiers and alternate qualifiers is deviced. This system ensures the equitable distribution of scholarship slots per region. For instance, in the event that a passer does not qualify as a principal qualifier in his/her campus of first choice (usually Main Campus), he/she can opt to grab the scholarship slot being offered in his/her campus of second choice (usually in his/her home region). The distribution of passers and possible alternate qualifiers are shown in Table 2.

While the present system ensures the equitable distribution of scholarship slots throughout the regions of the country on the one hand, it begs the question of whether the scholarship slots are being given to the best (in terms of NCE total score and sub-test scores) among the passers in the entire country.

```{r}
kable(APF_by_campus_year, format = "latex", booktabs = TRUE, 
      caption = "Number of Passers and Possible Alternate Qualifiers by Regional Campus",
      col.names = c("Campus",rep(c("P", "A"), times = 10))) %>% kable_styling(latex_options = "scale_down") %>%
  add_header_above(c(" "=1,"2008"=2, "2009"=2, "2010"=2, "2011"=2, "2012"=2,"2013"=2,"2014"=2,"2015"=2,"2016"=2,"2017"=2)) %>%
  add_footnote(c("For CBZRC, CRC, MRC, SRC, and ZRC, the zeros indicate that the campuses were not yet operational during those years."))
```


```{r}
kable(APF_by_region_year, format = "latex", booktabs = TRUE, 
      caption = "Number of Passers and Possible Alternate Qualifiers by Region",
      col.names = c("Campus",rep(c("P", "A"), times = 10))) %>% kable_styling(latex_options = "scale_down") %>%
  add_header_above(c(" "=1,"2008"=2, "2009"=2, "2010"=2, "2011"=2, "2012"=2,"2013"=2,"2014"=2,"2015"=2,"2016"=2,"2017"=2))
```

```{r}
ncetop1620 <- ncetd %>% 
  filter(passflag2 == "P") %>%
  group_by(year) %>%
  top_n(1620, score)
```

```{r}
# ncetd %>% tabyl(year, pass_flag, passflag2)
```
```{r}
ncetop1620diff <- ncetop1620 %>% tabyl(choice1, year) %>%
  gather(year, N, 2:11) %>% 
  mutate(Diff = case_when(choice1 == "MC"~N-240,
                          choice1 == "CBZRC"~N-120,
                          TRUE ~ N-90)) %>%
  mutate(year = lubridate::ymd(year, truncated = 2L))
ncetop1620diffwide <- dcast(setDT(ncetop1620diff), choice1~year, value.var = c("N", "Diff"), fun.aggregate = sum)
fwrite(ncetop1620diffwide, "ncetop1620diffwide.csv")
```

```{r}
#ncetop1620diff %>%
#  unite(Diff, N, Diff, sep = ": ") %>%
#  spread(year, Diff) %>%
#  rename(Campus = choice1, "2008"= "2011"="2011-01-01", "2012"="2012-01-01", "2013"="2013-01-01", "2014"="2014-01-01", "2015"="2015-01-01", "2016"="2016-01-01", "2017"="2017-01-01") %>%
#  filter(!is.na(Campus)) %>%
#  kable("latex", booktabs = TRUE, caption = "Number of students belonging to the top 1590 examinees by signified campus of first choice, $N_1$, and the number of students who did not make it as a principal qualifier in their choice campus (positive) or the number of students who did not make it to the top 1590 nationally but made it as principal qualifiers (negative) by region, $N_2$ ($N_1: N_2$).")
```

```{r}
ncetop1620diff %>% filter(!is.na(choice1)) %>% ggplot(aes(year, Diff)) + geom_line() + geom_hline(aes(yintercept = 0), linetype = "dashed") + facet_wrap(~choice1, scales = "free_y") +
  theme_bw()
```

## Alternates


```{r}
ncetop3240 <- ncetd %>% 
  filter(passflag2 == "passed" | pass_flag == 1) %>%
  group_by(year) %>%
  top_n(3180, score)
```

```{r}
# ncetd %>% tabyl(year, pass_flag, passflag2)
```
```{r}
ncetop3240diff <- ncetop3240 %>% tabyl(choice1, year) %>%
  gather(year, N, 2:11) %>% 
  mutate(Diff = case_when(choice1 == "MC"~N-240,
                          choice1 == "CBZRC"~N-120,
                          TRUE ~ N-90)) %>%
  mutate(year = lubridate::ymd(year, truncated = 2L))
ncetop3240diffwide <- dcast(setDT(ncetop3240diff), choice1~year, value.var = c("N", "Diff"), fun.aggregate = sum)
fwrite(ncetop3240diffwide, "ncetop3240diffwide.csv")
```

```{r}
ndiff <- fread("ndiff.csv", na.strings = "")

ndiff %>%
  mutate(Campus = case_when(is.na(Campus)~"No Choice",
                            TRUE~Campus)) %>%
  kable("latex", 
        booktabs = T,
        col.names = c("Campus", rep(c("N", "Diff"), times = 10)),
        caption = "Number of students belonging to the top 1620 examinees by signified campus of first choice, $N$, and the number of students who did not make it as a principal qualifier in their choice campus (positive) or the number of students who did not make it to the top 1620 nationally but made it as principal qualifiers (negative) by region, Diff.") %>%
  kable_styling(latex_options = "scale_down") %>%
  add_header_above(c(" "=1, "2008"=2,"2009"=2,"2010"=2,"2011"=2,"2012"=2,"2013"=2,"2014"=2,"2015"=2,"2016"=2,"2017"=2))
```

```{r}
ncetop3240diff %>% filter(!is.na(choice1)) %>% ggplot(aes(year, Diff)) + geom_line() + geom_hline(aes(yintercept = 0), linetype = "dashed") + facet_wrap(~choice1, scales = "free_y") +
  theme_bw()
```

```{r}
#ncetop3180 %>%
#  group_by(year, choice1, id) %>%
#  summarise(total = sum(score)) %>%
#  ggplot(aes(total)) + geom_histogram(bins = 30) + facet_wrap(~choice1)
```


```{r}
# uncomment in final report
# ncetop3180 %>%
#   group_by(choice1, year, id) %>%
#   summarise(total = sum(score)) %>%
#   mutate(pct = total / 220 * 100) %>%
#   summarise_at(vars(pct), funs(min,q1 = quantile(.,0.25), median, mean, q3 = quantile(.,.75),max, sd)) %>%
#   kable("markdown", latex_options = c("striped", "repeat_header"), digits = 2, caption = "Distribution of Total Score Percentages by Campus and by NCE Year")
```

